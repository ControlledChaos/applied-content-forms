"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=_superPropBase(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(t);if(e){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t,e){function r(t){return I[t]||!1}function n(t){return!t.attributes.id}function o(t){return c().filter(function(e){return e.attributes.id===t.attributes.id}).filter(function(e){return e.clientId!==t.clientId}).length}function i(t){var e=t.post_types||[];if(e.length){e.push("wp_block");var r=acf.get("postType");if(-1===e.indexOf(r))return!1}if("string"==typeof t.icon&&"<svg"===t.icon.substr(0,4)){var n=t.icon;t.icon=React.createElement(q,null,n)}t.icon||delete t.icon,wp.blocks.getCategories().filter(function(e){return e.slug===t.category}).pop()||(t.category="common");var o={id:{type:"string"},name:{type:"string"},data:{type:"object"},align:{type:"string"},mode:{type:"string"}},i=H,a=h;t.supports.align_text&&(o=g(o),i=k(i,t)),t.supports.align_content&&(o=v(o),i=_(i,t)),t=acf.parseArgs(t,{title:"",name:"",category:"",attributes:o,edit:function(t){return React.createElement(i,t)},save:function(t){return React.createElement(a,t)}}),I[t.name]=t;var c=wp.blocks.registerBlockType(t.name,t);return c.attributes.anchor&&(c.attributes.anchor={type:"string"}),c}function a(t){return"core/block-editor"===t?wp.data.select("core/block-editor")||wp.data.select("core/editor"):wp.data.select(t)}function c(t){for(var e=a("core/block-editor").getBlocks(),r=0;r<e.length;)e=e.concat(e[r].innerBlocks),r++;for(var n in t)e=e.filter(function(e){return e.attributes[n]===t[n]});return e}function s(e){var r=e.attributes,n=void 0===r?{}:r,o=e.query,i=void 0===o?{}:o,a=e.delay,c=void 0===a?0:a,s=n.id,u=M[s]||{query:{},timeout:!1,promise:t.Deferred()};return u.query=_objectSpread(_objectSpread({},u.query),i),clearTimeout(u.timeout),u.timeout=setTimeout(function(){t.ajax({url:acf.get("ajaxurl"),dataType:"json",type:"post",cache:!1,data:acf.prepareForAjax({action:"acf/ajax/fetch-block",block:JSON.stringify(n),query:u.query})}).always(function(){M[s]=null}).done(function(){u.promise.resolve.apply(this,arguments)}).fail(function(){u.promise.reject.apply(this,arguments)})},c),M[s]=u,u.promise}function u(t,e){return JSON.stringify(t)===JSON.stringify(e)}function l(t){var e=p(t.nodeName.toLowerCase());if(!e)return null;var r={};acf.arrayArgs(t.attributes).map(f).forEach(function(t){r[t.name]=t.value});var n=[e,r];return acf.arrayArgs(t.childNodes).forEach(function(t){if(t instanceof Text){var e=t.textContent.trim();e&&n.push(e)}else n.push(l(t))}),React.createElement.apply(this,n)}function p(t){switch(t){case"innerblocks":return O;case"script":return U;case"#comment":return null}return t}function f(t){var e=t.name,r=t.value;switch(e){case"class":e="className";break;case"style":var n={};r.split(";").forEach(function(t){var e=t.indexOf(":");if(e>0){var r=t.substr(0,e).trim(),o=t.substr(e+1).trim();"-"!==r.charAt(0)&&(r=acf.strCamelCase(r)),n[r]=o}}),r=n;break;default:if(0===e.indexOf("data-"))break;var o=acf.get("jsxAttributes");o[e]&&(e=o[e]);var i=r.charAt(0);"["!==i&&"{"!==i||(r=JSON.parse(r)),"true"!==r&&"false"!==r||(r="true"===r)}return{name:e,value:r}}function h(){return React.createElement(O.Content,null)}function d(){wp.blockEditor||(wp.blockEditor=wp.editor);var t=acf.get("blockTypes");t&&t.map(i)}function y(t){var e="top";return["top","center","bottom"].includes(t)?t:e}function m(t){var e=["left","center","right"],r=acf.get("rtl")?"right":"left";return e.includes(t)?t:r}function b(t){var e="center center";if(t){var r=_slicedToArray(t.split(" "),2),n=r[0],o=r[1];return y(n)+" "+m(o)}return e}function v(t){return t.align_content={type:"string"},t}function _(t,r){var n,o,i=r.supports.align_content;switch(i){case"matrix":n=G||V,o=b;break;default:n=X,o=y}return n===e?(console.warn('The "'.concat(i,'" alignment component was not found.')),t):(r.align_content=o(r.align_content),function(e){function r(){return _classCallCheck(this,r),i.apply(this,arguments)}_inherits(r,e);var i=_createSuper(r);return _createClass(r,[{key:"render",value:function(){function e(t){a({align_content:o(t)})}var r=this.props,i=r.attributes,a=r.setAttributes,c=i.align_content;return React.createElement(x,null,React.createElement(C,{group:"block"},React.createElement(n,{label:acf.__("Change content alignment"),value:o(c),onChange:e})),React.createElement(t,this.props))}}]),r}(T))}function g(t){return t.align_text={type:"string"},t}function k(t,e){var r=m;return e.align_text=r(e.align_text),function(e){function n(){return _classCallCheck(this,n),o.apply(this,arguments)}_inherits(n,e);var o=_createSuper(n);return _createClass(n,[{key:"render",value:function(){function e(t){i({align_text:r(t)})}var n=this.props,o=n.attributes,i=n.setAttributes,a=o.align_text;return React.createElement(x,null,React.createElement(C,null,React.createElement(Q,{value:r(a),onChange:e})),React.createElement(t,this.props))}}]),n}(T)}var w=wp.blockEditor,C=w.BlockControls,R=w.InspectorControls,O=w.InnerBlocks,E=wp.components,A=E.Toolbar,S=E.IconButton,j=E.Placeholder,P=E.Spinner,x=wp.element.Fragment,T=React.Component,D=wp.data.withSelect,B=wp.compose.createHigherOrderComponent,I={},M={};acf.parseJSX=function(e){return l(t(e)[0])};var N=B(function(t){return function(i){function a(t){var i;_classCallCheck(this,a);var s=(i=c.call(this,t)).props,u=s.name,l=s.attributes,p=r(u);if(!p)return _possibleConstructorReturn(i);if(n(t)){for(var f in l.id=acf.uniqid("block_"),p.attributes)l[f]===e&&p[f]!==e&&(l[f]=p[f]);return _possibleConstructorReturn(i)}return o(t)?(l.id=acf.uniqid("block_"),_possibleConstructorReturn(i)):i}_inherits(a,i);var c=_createSuper(a);return _createClass(a,[{key:"render",value:function(){return React.createElement(t,this.props)}}]),a}(T)},"withDefaultAttributes");wp.hooks.addFilter("editor.BlockListBlock","acf/with-default-attributes",N);var H=function(t){function e(t){var r;return _classCallCheck(this,e),(r=n.call(this,t)).setup(),r}_inherits(e,t);var n=_createSuper(e);return _createClass(e,[{key:"setup",value:function(){function t(t){-1===t.indexOf(o.mode)&&(o.mode=t[0])}var e=this.props,n=e.name,o=e.attributes;switch(r(n).mode){case"edit":t(["edit","preview"]);break;case"preview":t(["preview","edit"]);break;default:t(["auto"])}}},{key:"render",value:function(){function t(){i({mode:"preview"===a?"edit":"preview"})}var e=this.props,n=e.name,o=e.attributes,i=e.setAttributes,a=o.mode,c=r(n).supports.mode;"auto"===a&&(c=!1);var s="preview"===a?acf.__("Switch to Edit"):acf.__("Switch to Preview"),u="preview"===a?"edit":"welcome-view-site";return React.createElement(x,null,React.createElement(C,null,c&&React.createElement(A,null,React.createElement(S,{className:"components-icon-button components-toolbar__control",label:s,icon:u,onClick:t}))),React.createElement(R,null,"preview"===a&&React.createElement("div",{className:"acf-block-component acf-block-panel"},React.createElement(z,this.props))),React.createElement($,this.props))}}]),e}(T),L=function(t){function e(){return _classCallCheck(this,e),r.apply(this,arguments)}_inherits(e,t);var r=_createSuper(e);return _createClass(e,[{key:"render",value:function(){var t=this.props,e=t.attributes,r=t.isSelected,n=e.mode;return React.createElement("div",{className:"acf-block-component acf-block-body"},"auto"===n&&r?React.createElement(z,this.props):"auto"!==n||r?"preview"===n?React.createElement(F,this.props):React.createElement(z,this.props):React.createElement(F,this.props))}}]),e}(T),$=D(function(t,e){var r=e.clientId,n=t("core/block-editor").getBlockRootClientId(r);return{index:t("core/block-editor").getBlockIndex(r,n)}})(L),q=function(t){function e(){return _classCallCheck(this,e),r.apply(this,arguments)}_inherits(e,t);var r=_createSuper(e);return _createClass(e,[{key:"render",value:function(){return React.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.children}})}}]),e}(T),U=function(e){function r(){return _classCallCheck(this,r),n.apply(this,arguments)}_inherits(r,e);var n=_createSuper(r);return _createClass(r,[{key:"render",value:function(){var t=this;return React.createElement("div",{ref:function(e){return t.el=e}})}},{key:"setHTML",value:function(e){t(this.el).html("<script>".concat(e,"</script>"))}},{key:"componentDidUpdate",value:function(){this.setHTML(this.props.children)}},{key:"componentDidMount",value:function(){this.setHTML(this.props.children)}}]),r}(T),J={},W=function(r){function n(t){var e;return _classCallCheck(this,n),(e=o.call(this,t)).setRef=e.setRef.bind(_assertThisInitialized(e)),e.id="",e.el=!1,e.subscribed=!0,e.renderMethod="jQuery",e.setup(t),e.loadState(),e}_inherits(n,r);var o=_createSuper(n);return _createClass(n,[{key:"setup",value:function(t){}},{key:"fetch",value:function(){}},{key:"loadState",value:function(){this.state=J[this.id]||{}}},{key:"setState",value:function(t){J[this.id]=_objectSpread(_objectSpread({},this.state),t),this.subscribed&&_get(_getPrototypeOf(n.prototype),"setState",this).call(this,t)}},{key:"setHtml",value:function(e){if((e=e?e.trim():"")!==this.state.html){var r={html:e};"jsx"===this.renderMethod?(r.jsx=acf.parseJSX(e),r.$el=t(this.el)):r.$el=t(e),this.setState(r)}}},{key:"setRef",value:function(t){this.el=t}},{key:"render",value:function(){return this.state.jsx?React.createElement("div",{ref:this.setRef},this.state.jsx):React.createElement("div",{ref:this.setRef},React.createElement(j,null,React.createElement(P,null)))}},{key:"shouldComponentUpdate",value:function(t,e){return t.index!==this.props.index&&this.componentWillMove(),e.html!==this.state.html}},{key:"display",value:function(e){if("jQuery"===this.renderMethod){var r=this.state.$el,n=r.parent(),o=t(this.el);o.html(r),n.length&&n[0]!==o[0]&&n.html(r.clone())}switch(e){case"append":this.componentDidAppend();break;case"remount":this.componentDidRemount()}}},{key:"componentDidMount",value:function(){this.state.html===e?this.fetch():this.display("remount")}},{key:"componentDidUpdate",value:function(t,e){this.display("append")}},{key:"componentDidAppend",value:function(){acf.doAction("append",this.state.$el)}},{key:"componentWillUnmount",value:function(){acf.doAction("unmount",this.state.$el),this.subscribed=!1}},{key:"componentDidRemount",value:function(){var t=this;this.subscribed=!0,setTimeout(function(){acf.doAction("remount",t.state.$el)})}},{key:"componentWillMove",value:function(){var t=this;acf.doAction("unmount",this.state.$el),setTimeout(function(){acf.doAction("remount",t.state.$el)})}}]),n}(T),z=function(t){function r(){return _classCallCheck(this,r),n.apply(this,arguments)}_inherits(r,t);var n=_createSuper(r);return _createClass(r,[{key:"setup",value:function(t){this.id="BlockForm-".concat(t.attributes.id)}},{key:"fetch",value:function(){var t=this;s({attributes:this.props.attributes,query:{form:!0}}).done(function(e){t.setHtml(e.data.form)})}},{key:"componentDidAppend",value:function(){function t(t){var r=arguments.length>0&&t!==e&&t,n=acf.serialize(a,"acf-".concat(o.id));r?o.data=n:i({data:n})}_get(_getPrototypeOf(r.prototype),"componentDidAppend",this).call(this);var n=this.props,o=n.attributes,i=n.setAttributes,a=this.state.$el,c=!1;a.on("change keyup",function(){clearTimeout(c),c=setTimeout(t,300)}),o.data||t(!0)}}]),r}(W),F=function(t){function n(){return _classCallCheck(this,n),o.apply(this,arguments)}_inherits(n,t);var o=_createSuper(n);return _createClass(n,[{key:"setup",value:function(t){this.id="BlockPreview-".concat(t.attributes.id),r(t.name).supports.jsx&&(this.renderMethod="jsx")}},{key:"fetch",value:function(t){var r=this,n=arguments.length>0&&t!==e?t:{},o=n.attributes,i=void 0===o?this.props.attributes:o,a=n.delay,c=void 0===a?0:a;if(this.setState({prevAttributes:i}),this.state.html===e){var u=acf.get("preloadedBlocks");if(u&&u[i.id])return void this.setHtml(u[i.id])}s({attributes:i,query:{preview:!0},delay:c}).done(function(t){r.setHtml(t.data.preview)})}},{key:"componentDidAppend",value:function(){_get(_getPrototypeOf(n.prototype),"componentDidAppend",this).call(this);var t=this.props.attributes,e=this.state.$el,r=t.name.replace("acf/","");acf.doAction("render_block_preview",e,t),acf.doAction("render_block_preview/type=".concat(r),e,t)}},{key:"shouldComponentUpdate",value:function(t,e){var r=t.attributes,o=this.props.attributes;if(!u(r,o)){var i=0;r.className!==o.className&&(i=300),r.anchor!==o.anchor&&(i=300),this.fetch({attributes:r,delay:i})}return _get(_getPrototypeOf(n.prototype),"shouldComponentUpdate",this).call(this,t,e)}},{key:"componentDidRemount",value:function(){_get(_getPrototypeOf(n.prototype),"componentDidRemount",this).call(this),u(this.state.prevAttributes,this.props.attributes)||this.fetch()}}]),n}(W);acf.addAction("prepare",d);var K=wp.blockEditor,Q=K.AlignmentToolbar,X=K.BlockVerticalAlignmentToolbar,V=wp.blockEditor.__experimentalBlockAlignmentMatrixToolbar||wp.blockEditor.BlockAlignmentMatrixToolbar,G=wp.blockEditor.__experimentalBlockAlignmentMatrixControl||wp.blockEditor.BlockAlignmentMatrixControl}(jQuery);